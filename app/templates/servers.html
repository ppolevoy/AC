{% extends "base.html" %}

{% block title %}Faktura Apps - –°–µ—Ä–≤–µ—Ä—ã{% endblock %}

{% block page_title %}–°–µ—Ä–≤–µ—Ä—ã{% endblock %}

{% block subheader %}
<div class="subheader">
    <button class="add-server-btn-alt" id="add-server-btn">
        <span class="add-icon">+</span>
        <span>–ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä</span>
    </button>
</div>
{% endblock %}

{% block content %}
<div class="servers-section">
    <div id="servers-container" class="servers-grid">
        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ -->
        <div class="server-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤...</div>
    </div>
    
    <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤) -->
    <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-icon">üñ•Ô∏è</div>
        <div class="empty-text">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤</div>
        <button class="add-server-btn-alt" id="add-server-empty-btn">
            <span class="add-icon">+</span>
            <span>–ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä</span>
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const serversContainer = document.getElementById('servers-container');
        const emptyState = document.getElementById('empty-state');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤
        async function loadServers() {
            try {
                const response = await fetch('/api/servers');
                const data = await response.json();
                
                if (data.success) {
                    renderServers(data.servers);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–æ–≤:', data.error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–æ–≤:', error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
        function renderServers(servers) {
            serversContainer.innerHTML = '';
            
            if (servers.length === 0) {
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                serversContainer.style.display = 'none';
                emptyState.style.display = 'flex';
                return;
            }
            
            // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä—ã –µ—Å—Ç—å, —Å–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            serversContainer.style.display = 'grid';
            emptyState.style.display = 'none';
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
            servers.forEach(server => {
                const statusClass = server.status === 'online' ? 'online' : 'offline';
                const statusText = server.status === 'online' ? 'Online' : 'Offline';
                
                const serverCard = document.createElement('div');
                serverCard.className = 'server-card';
                serverCard.innerHTML = `
                    <div class="server-header">
                        <div class="server-name">${server.name}</div>
                        <div class="server-status">
                            <div class="status-dot ${statusClass}"></div>
                            <span class="status-text ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="server-info">
                        <div class="info-row">
                            <span class="info-label">IP:</span>
                            <span>${server.ip}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–ü–æ—Ä—Ç:</span>
                            <span>${server.port}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π:</span>
                            <span>${server.app_count || 0}</span>
                        </div>
                    </div>
                    <div class="server-actions">
                        <button class="server-btn refresh-btn" title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" data-server-id="${server.id}">‚ü≥</button>
                        <button class="server-btn edit" title="–ò–∑–º–µ–Ω–∏—Ç—å" data-server-id="${server.id}">‚úé</button>
                        <button class="server-btn delete" title="–£–¥–∞–ª–∏—Ç—å" data-server-id="${server.id}">‚úï</button>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Ä–≤–µ—Ä–∞
				serverCard.addEventListener('click', function(e) {
					// –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø–æ –∫–Ω–æ–ø–∫–∞–º –¥–µ–π—Å—Ç–≤–∏–π
					if (!e.target.closest('.server-btn')) {
						// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
						window.location.href = `/server/${server.id}`;
					}
				});
                
                serversContainer.appendChild(serverCard);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
            setupActionButtons();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–∫–∞–º –¥–µ–π—Å—Ç–≤–∏–π
        function setupActionButtons() {
            // –ö–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.querySelectorAll('.refresh-btn').forEach(btn => {
                btn.addEventListener('click', async function(e) {
                    e.stopPropagation();
                    const serverId = this.getAttribute('data-server-id');
                    await refreshServer(serverId);
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.querySelectorAll('.server-btn.edit').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const serverId = this.getAttribute('data-server-id');
                    showEditServerModal(serverId);
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
            document.querySelectorAll('.server-btn.delete').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const serverId = this.getAttribute('data-server-id');
                    showDeleteServerModal(serverId);
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–µ—Ä–µ
        async function refreshServer(serverId) {
            try {
                const btn = document.querySelector(`.refresh-btn[data-server-id="${serverId}"]`);
                if (btn) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ä–∞—â–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏
                    btn.classList.add('rotating');
                }
                
                const response = await fetch(`/api/servers/${serverId}/refresh`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    loadServers();
                    showNotification('–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
            } finally {
                // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ä–∞—â–µ–Ω–∏—è
                const btn = document.querySelector(`.refresh-btn[data-server-id="${serverId}"]`);
                if (btn) {
                    btn.classList.remove('rotating');
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
        function showAddServerModal() {
            const modalContent = `
                <form id="add-server-form">
                    <div class="form-group">
                        <label for="server-name">–ò–º—è —Å–µ—Ä–≤–µ—Ä–∞:</label>
                        <input type="text" id="server-name" name="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="server-ip">IP-–∞–¥—Ä–µ—Å:</label>
                        <input type="text" id="server-ip" name="ip" class="form-control" required pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$">
                    </div>
                    <div class="form-group">
                        <label for="server-port">–ü–æ—Ä—Ç:</label>
                        <input type="number" id="server-port" name="port" class="form-control" required min="1" max="65535">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="submit-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </form>
            `;
            
            window.showModal('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞', modalContent);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('add-server-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('server-name').value;
                const ip = document.getElementById('server-ip').value;
                const port = document.getElementById('server-port').value;
                
                try {
                    const response = await fetch('/api/servers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name,
                            ip,
                            port: parseInt(port)
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
                        window.closeModal();
                        loadServers();
                        showNotification('–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                        showError(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
        async function showEditServerModal(serverId) {
            try {
                const response = await fetch(`/api/servers/${serverId}`);
                const data = await response.json();
                
                if (data.success) {
                    const server = data.server;
                    
                    const modalContent = `
                        <form id="edit-server-form">
                            <div class="form-group">
                                <label for="server-name">–ò–º—è —Å–µ—Ä–≤–µ—Ä–∞:</label>
                                <input type="text" id="server-name" name="name" class="form-control" value="${server.name}" required>
                            </div>
                            <div class="form-group">
                                <label for="server-ip">IP-–∞–¥—Ä–µ—Å:</label>
                                <input type="text" id="server-ip" name="ip" class="form-control" value="${server.ip}" required pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$">
                            </div>
                            <div class="form-group">
                                <label for="server-port">–ü–æ—Ä—Ç:</label>
                                <input type="number" id="server-port" name="port" class="form-control" value="${server.port}" required min="1" max="65535">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    `;
                    
                    window.showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞', modalContent);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
                    document.getElementById('edit-server-form').addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const name = document.getElementById('server-name').value;
                        const ip = document.getElementById('server-ip').value;
                        const port = document.getElementById('server-port').value;
                        
                        try {
                            const response = await fetch(`/api/servers/${serverId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    name,
                                    ip,
                                    port: parseInt(port)
                                })
                            });
                            
                            const data = await response.json();
                            
                            if (data.success) {
                                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
                                window.closeModal();
                                loadServers();
                                showNotification('–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
                            } else {
                                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                                showError(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                            }
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                        }
                    });
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–µ—Ä–µ:', data.error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–µ—Ä–µ');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–µ—Ä–µ:', error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–µ—Ä–µ');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
        function showDeleteServerModal(serverId) {
            const modalContent = `
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä?</p>
                <p>–í–º–µ—Å—Ç–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏—è.</p>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="delete-btn" id="confirm-delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;
            
            window.showModal('–£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞', modalContent);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
            document.getElementById('confirm-delete-btn').addEventListener('click', async function() {
                try {
                    const response = await fetch(`/api/servers/${serverId}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
                        window.closeModal();
                        loadServers();
                        showNotification('–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                        showError(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä');
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
        function showNotification(message) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', message);
            
            // –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
        function showError(message) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
            console.error('–û—à–∏–±–∫–∞:', message);
            
            // –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 5000);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
        document.getElementById('add-server-btn').addEventListener('click', showAddServerModal);
        document.getElementById('add-server-empty-btn').addEventListener('click', showAddServerModal);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadServers();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
        setInterval(loadServers, 60000);
    });
</script>
{% endblock %}
