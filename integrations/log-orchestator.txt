192.168.8.17 - - [30/Nov/2025 05:21:56] "GET /api/applications/187/artifacts?limit=20 HTTP/1.1" 404 -
[2025-11-30 05:22:10,770] INFO in applications_routes: Группировка mdse_fiz_2: strategy=by_group, orchestrator=True, key=('update_multiple_instances_v1_9-latest.yaml {server} {app} {distr_url} {mode}', 45)
[2025-11-30 05:22:10,771] INFO in applications_routes: Группировка mdse_fiz_1: strategy=by_group, orchestrator=True, key=('update_multiple_instances_v1_9-latest.yaml {server} {app} {distr_url} {mode}', 45)
[2025-11-30 05:22:10,771] INFO in applications_routes: Создано 1 групп для 2 приложений (стратегии применены)
[2025-11-30 05:22:10,775] INFO in queue: Задача 01f5069a... (update) добавлена в очередь
[2025-11-30 05:22:10,775] INFO in applications_routes: Создана задача для группы (IDs: [175, 187], names: mdse_fiz_2,mdse_fiz_1, task_id: 01f5069a-5ac3-4b23-a7a4-f0663db63ef9)
[2025-11-30 05:22:10,778] INFO in queue: Обработка задачи 01f5069a... (update)
192.168.8.17 - - [30/Nov/2025 05:22:10] "POST /api/applications/batch_update HTTP/1.1" 200 -
[2025-11-30 05:22:10,781] INFO in queue: Режим orchestrator активирован: orchestrator-50-50.yml
[2025-11-30 05:22:10,782] INFO in queue: Загружен orchestrator: Playbook для автоматизированного обновления приложений с использованием HAProxy API vNone
[2025-11-30 05:22:10,787] INFO in queue: HAProxy API URL: http://192.168.8.88:5000/haproxy/fdmz
[2025-11-30 05:22:10,787] INFO in queue: App mdse_fiz_2 mapped to HAProxy server fdse_mdse_fiz_2
[2025-11-30 05:22:10,788] INFO in queue: App mdse_fiz_1 mapped to HAProxy server fdse_mdse_fiz_1
[2025-11-30 05:22:10,789] INFO in queue: Сформированы составные имена для orchestrator (расширенный формат с HAProxy):
[2025-11-30 05:22:10,789] INFO in queue:   fdse::mdse_fiz_2::fdse_mdse_fiz_2
[2025-11-30 05:22:10,789] INFO in queue:   fdse::mdse_fiz_1::fdse_mdse_fiz_1
[2025-11-30 05:22:10,789] INFO in queue: Mapping серверов и приложений:
[2025-11-30 05:22:10,789] INFO in queue:   fdse: mdse_fiz_2, mdse_fiz_1
[2025-11-30 05:22:10,789] INFO in queue: HAProxy backends: bn_p-mdse_fiz
[2025-11-30 05:22:10,789] INFO in queue: Using HAProxy backend 'bn_p-mdse_fiz' from database mapping
[2025-11-30 05:22:10,790] INFO in queue: Параметры orchestrator из БД:
[2025-11-30 05:22:10,790] INFO in queue:   Required: ['distr_url', 'drain_delay', 'app_instances', 'haproxy_api_url', 'haproxy_backend', 'update_playbook', 'wait_after_update']
[2025-11-30 05:22:10,790] INFO in queue:   Optional: ['wait_after_update']
[2025-11-30 05:22:10,790] INFO in queue: Сформирован playbook_path с параметрами: orchestrator-50-50.yml {distr_url} {drain_delay} {app_instances} {haproxy_api_url} {haproxy_backend} {update_playbook} {wait_after_update}
[2025-11-30 05:22:10,790] INFO in queue: Используется default для 'wait_after_update': извлечено 1800 из '1800 сек = 30 мин'
[2025-11-30 05:22:10,790] WARNING in queue: Параметры без значений: ['wait_after_update']
[2025-11-30 05:22:10,790] INFO in queue: Финальные значения extra_params (только значения, без описаний):
[2025-11-30 05:22:10,790] INFO in queue:   distr_url = http://192.168.8.46:9000/repository/maven-releases/ru/ftc/mDSE/1.9/mDSE-1.9.war (type: str)
[2025-11-30 05:22:10,790] INFO in queue:   drain_delay = 300 (type: int)
[2025-11-30 05:22:10,790] INFO in queue:   app_instances = fdse::mdse_fiz_2::fdse_mdse_fiz_2,fdse::mdse_fiz_1::fdse_mdse_fiz_1 (type: str)
[2025-11-30 05:22:10,791] INFO in queue:   haproxy_api_url = http://192.168.8.88:5000/haproxy/fdmz (type: str)
[2025-11-30 05:22:10,791] INFO in queue:   haproxy_backend = bn_p-mdse_fiz (type: str)
[2025-11-30 05:22:10,791] INFO in queue:   update_playbook = update_multiple_instances_v1_9-latest.yaml (type: str)
[2025-11-30 05:22:10,791] INFO in queue:   wait_after_update = 1800 (type: int)
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Получены extra_params для orchestrator: {'distr_url': 'http://192.168.8.46:9000/repository/maven-releases/ru/ftc/mDSE/1.9/mDSE-1.9.war', 'drain_delay': 300, 'app_instances': 'fdse::mdse_fiz_2::fdse_mdse_fiz_2,fdse::mdse_fiz_1::fdse_mdse_fiz_1', 'haproxy_api_url': 'http://192.168.8.88:5000/haproxy/fdmz', 'haproxy_backend': 'bn_p-mdse_fiz', 'update_playbook': 'update_multiple_instances_v1_9-latest.yaml', 'wait_after_update': 1800}
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: distr_url
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: drain_delay
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: app_instances
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: haproxy_api_url
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: haproxy_backend
[2025-11-30 05:22:10,792] INFO in ssh_ansible_service: Обнаружен динамический параметр: update_playbook
[2025-11-30 05:22:10,793] INFO in ssh_ansible_service: Обнаружен динамический параметр: wait_after_update
[2025-11-30 05:22:10,793] INFO in ssh_ansible_service: Parsed playbook config: path='orchestrator-50-50.yml', parameters=['distr_url', 'drain_delay', 'app_instances', 'haproxy_api_url', 'haproxy_backend', 'update_playbook', 'wait_after_update']
[2025-11-30 05:22:10,793] WARNING in ssh_ansible_service: Unknown dynamic parameter 'haproxy_api_url' in playbook path
[2025-11-30 05:22:10,793] WARNING in ssh_ansible_service: Unknown dynamic parameter 'haproxy_backend' in playbook path
[2025-11-30 05:22:10,793] ERROR in ssh_ansible_service: Недопустимые параметры в playbook path: haproxy_api_url, haproxy_backend
[2025-11-30 05:22:10,795] ERROR in queue: Ошибка при выполнении задачи 01f5069a...: Недопустимые параметры в playbook path: haproxy_api_url, haproxy_backend
[2025-11-30 05:22:10,795] ERROR in queue: Traceback (most recent call last):
  File "/app/app/tasks/queue.py", line 246, in _process_tasks
    result = self._process_update_task(task_id)
  File "/app/app/tasks/queue.py", line 879, in _process_update_task
    raise Exception(message)
Exception: Недопустимые параметры в playbook path: haproxy_api_url, haproxy_backend